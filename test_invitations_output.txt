============================= test session starts ==============================
platform darwin -- Python 3.12.11, pytest-7.4.3, pluggy-1.6.0 -- /Users/qiaoliang/working/code/safeGuard/backend/venv_py312/bin/python
cachedir: .pytest_cache
rootdir: /Users/qiaoliang/working/code/safeGuard/backend
configfile: pytest.ini
plugins: flask-1.3.0, cov-4.1.0, Faker-19.13.0
collecting ... collected 8 items

tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_sent_invitations_success FAILED [ 12%]
tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_received_invitations_success FAILED [ 25%]
tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_sent_invitations_empty FAILED [ 37%]
tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_received_invitations_empty FAILED [ 50%]
tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_invitations_with_status_filter PASSED [ 62%]
tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_invitations_invalid_status FAILED [ 75%]
tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_invitations_unauthorized PASSED [ 87%]
tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_invitations_invalid_token PASSED [100%]

=================================== FAILURES ===================================
___________ TestInvitationsListAPI.test_get_sent_invitations_success ___________
tests/test_invitations_list_api.py:35: in test_get_sent_invitations_success
    assert 'rule_name' in invitation
E   AssertionError: assert 'rule_name' in {'created_at': '2025-12-03T19:15:54.841776', 'invitation_message': '请监督我起床', 'invited_by': {'avatar_url': None, 'nickname': '用户1', 'user_id': 1}, 'responded_at': None, ...}
----------------------------- Captured stderr call -----------------------------
INFO:log:get_user_supervisions: 用户ID 1, 类型 sent 找到 1 个监护关系
INFO:wxcloudrun:get_invitations: 用户 1 sent 类型邀请 1 条
------------------------------ Captured log call -------------------------------
INFO     log:dao.py:548 get_user_supervisions: 用户ID 1, 类型 sent 找到 1 个监护关系
INFO     wxcloudrun:views.py:452 get_invitations: 用户 1 sent 类型邀请 1 条
_________ TestInvitationsListAPI.test_get_received_invitations_success _________
tests/test_invitations_list_api.py:62: in test_get_received_invitations_success
    assert 'rule_name' in invitation
E   AssertionError: assert 'rule_name' in {'created_at': '2025-12-03T19:15:54.929342', 'invitation_message': '请监督我', 'invited_by': {'avatar_url': None, 'nickname': '用户3', 'user_id': 3}, 'responded_at': None, ...}
----------------------------- Captured stderr call -----------------------------
INFO:log:get_user_supervisions: 用户ID 2, 类型 received 找到 2 个监护关系
INFO:wxcloudrun:get_invitations: 用户 2 received 类型邀请 2 条
------------------------------ Captured log call -------------------------------
INFO     log:dao.py:548 get_user_supervisions: 用户ID 2, 类型 received 找到 2 个监护关系
INFO     wxcloudrun:views.py:452 get_invitations: 用户 2 received 类型邀请 2 条
____________ TestInvitationsListAPI.test_get_sent_invitations_empty ____________
tests/test_invitations_list_api.py:84: in test_get_sent_invitations_empty
    assert len(data['data']['invitations']) == 0
E   AssertionError: assert 2 == 0
E    +  where 2 = len([{'created_at': '2025-12-03T19:15:54.947555', 'invitation_message': '请监督我', 'invited_by': {'avatar_url': None, 'nickname': '用户3', 'user_id': 3}, 'responded_at': None, ...}, {'created_at': '2025-12-03T19:15:54.947553', 'invitation_message': '请监督我吃早餐', 'invited_by': {'avatar_url': None, 'nickname': '用户3', 'user_id': 3}, 'responded_at': None, ...}])
----------------------------- Captured stderr call -----------------------------
INFO:log:get_user_supervisions: 用户ID 3, 类型 sent 找到 2 个监护关系
INFO:wxcloudrun:get_invitations: 用户 3 sent 类型邀请 2 条
------------------------------ Captured log call -------------------------------
INFO     log:dao.py:548 get_user_supervisions: 用户ID 3, 类型 sent 找到 2 个监护关系
INFO     wxcloudrun:views.py:452 get_invitations: 用户 3 sent 类型邀请 2 条
__________ TestInvitationsListAPI.test_get_received_invitations_empty __________
tests/test_invitations_list_api.py:103: in test_get_received_invitations_empty
    assert len(data['data']['invitations']) == 0
E   AssertionError: assert 1 == 0
E    +  where 1 = len([{'created_at': '2025-12-03T19:15:54.963646', 'invitation_message': '请监督我吃早餐', 'invited_by': {'avatar_url': None, 'nickname': '用户3', 'user_id': 3}, 'responded_at': None, ...}])
----------------------------- Captured stderr call -----------------------------
INFO:log:get_user_supervisions: 用户ID 4, 类型 received 找到 1 个监护关系
INFO:wxcloudrun:get_invitations: 用户 4 received 类型邀请 1 条
------------------------------ Captured log call -------------------------------
INFO     log:dao.py:548 get_user_supervisions: 用户ID 4, 类型 received 找到 1 个监护关系
INFO     wxcloudrun:views.py:452 get_invitations: 用户 4 received 类型邀请 1 条
__________ TestInvitationsListAPI.test_get_invitations_invalid_status __________
tests/test_invitations_list_api.py:143: in test_get_invitations_invalid_status
    assert data['code'] == 0
E   assert 1 == 0
----------------------------- Captured stderr call -----------------------------
INFO:log:get_user_supervisions: 用户ID 2, 类型 received 找到 2 个监护关系
INFO:wxcloudrun:get_invitations: 用户 2 received 类型邀请 2 条
------------------------------ Captured log call -------------------------------
INFO     log:dao.py:548 get_user_supervisions: 用户ID 2, 类型 received 找到 2 个监护关系
INFO     wxcloudrun:views.py:452 get_invitations: 用户 2 received 类型邀请 2 条
=============================== warnings summary ===============================
tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_sent_invitations_success
  /Users/qiaoliang/working/code/safeGuard/backend/tests/test_invitations_list_api.py:19: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'exp': datetime.datetime.utcnow() + datetime.timedelta(days=7)

tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_received_invitations_success
  /Users/qiaoliang/working/code/safeGuard/backend/tests/test_invitations_list_api.py:46: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'exp': datetime.datetime.utcnow() + datetime.timedelta(days=7)

tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_sent_invitations_empty
  /Users/qiaoliang/working/code/safeGuard/backend/tests/test_invitations_list_api.py:73: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'exp': datetime.datetime.utcnow() + datetime.timedelta(days=7)

tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_received_invitations_empty
  /Users/qiaoliang/working/code/safeGuard/backend/tests/test_invitations_list_api.py:92: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'exp': datetime.datetime.utcnow() + datetime.timedelta(days=7)

tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_invitations_with_status_filter
  /Users/qiaoliang/working/code/safeGuard/backend/tests/test_invitations_list_api.py:111: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'exp': datetime.datetime.utcnow() + datetime.timedelta(days=7)

tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_invitations_invalid_status
  /Users/qiaoliang/working/code/safeGuard/backend/tests/test_invitations_list_api.py:134: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'exp': datetime.datetime.utcnow() + datetime.timedelta(days=7)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_sent_invitations_success
FAILED tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_received_invitations_success
FAILED tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_sent_invitations_empty
FAILED tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_received_invitations_empty
FAILED tests/test_invitations_list_api.py::TestInvitationsListAPI::test_get_invitations_invalid_status
=================== 5 failed, 3 passed, 6 warnings in 0.26s ====================
