# SafeGuard API 文档

本目录包含 SafeGuard 后端系统的所有 API 接口文档，按照功能模块分类。

## 文档列表

1. [API_auth.md](./API_auth.md) - 认证相关API
   - 微信登录
   - 刷新Token
   - 用户登出
   - 手机号注册
   - 手机号验证码登录
   - 手机号密码登录
   - 手机号验证码+密码登录

2. [API_user.md](./API_user.md) - 用户管理API
   - 获取/更新用户信息
   - 搜索用户
   - 绑定手机号
   - 绑定微信
   - 社区工作人员身份验证

3. [API_checkin.md](./API_checkin.md) - 打卡功能API
   - 获取今日打卡事项
   - 执行打卡
   - 标记为missed
   - 撤销打卡
   - 获取打卡历史
   - 打卡规则管理（增删改查）

4. [API_sms.md](./API_sms.md) - 短信服务API
   - 发送短信验证码

5. [API_supervision.md](./API_supervision.md) - 监督功能API
   - 邀请监督者
   - 生成监督邀请链接
   - 解析监督邀请链接
   - 获取监督邀请列表
   - 接受/拒绝监督邀请
   - 获取我监督的用户列表
   - 获取我的监护人列表
   - 获取被监督用户打卡记录

6. [API_share.md](./API_share.md) - 分享功能API
   - 创建打卡分享链接
   - 解析分享链接
   - 分享页面入口

7. [API_community.md](./API_community.md) - 社区管理API
   - **社区CRUD**: 创建、查询、更新、删除社区
   - **社区状态**: 启用/停用社区
   - **社区操作**: 合并社区、拆分社区
   - **工作人员管理**: 添加/移除工作人员(主管/专员)
   - **用户管理**: 添加/移除社区用户
   - **用户搜索**: 按昵称或手机号搜索用户
   - **特殊社区**: 安卡大家庭、黑屋逻辑

8. [API_misc.md](./API_misc.md) - 其他功能API
   - 计数器操作
   - 获取计数器值
   - 获取环境配置信息
   - 主页
   - 环境配置查看器

## API 通用说明

### 认证方式
- **Bearer Token**: 在请求头中添加 `Authorization: Bearer <token>`
- **无需认证**: 部分API（如登录、注册、发送验证码）不需要认证

### 响应格式

**重要约定**: 
- HTTP 状态码统一返回 **200** (除非服务器内部错误返回 500 或路由不存在返回 404)
- 业务状态通过响应体中的 `code` 字段判断: `code=1` 表示成功, `code=0` 表示失败
- 失败时 `msg` 字段包含具体错误信息, `data` 可为空对象 `{}` 或包含必要的提示数据

所有API响应都遵循统一格式：

**成功响应** (HTTP 200):
```json
{
  "code": 1,        // 业务状态码：1-成功
  "msg": "success", // 状态消息
  "data": {...}     // 响应数据，具体结构见各API文档
}
```

**失败响应** (HTTP 200):
```json
{
  "code": 0,                    // 业务状态码：0-失败
  "msg": "权限不足",             // 具体错误信息
  "data": {}                    // 空对象或包含必要提示数据
}
```

### HTTP 状态码说明
- **200**: 正常响应 (业务成功或失败都返回200,通过code字段区分)
- **404**: 路由不存在
- **500**: 服务器内部错误

### 业务错误码 (code字段)
- **1**: 成功
- **0**: 失败 (具体原因见 msg 字段)

**常见错误消息**:
- "权限不足"
- "参数错误"
- "资源不存在"
- "操作失败"
- "Token无效或已过期"

### 时间格式
- 日期格式：`YYYY-MM-DD`
- 时间格式：`HH:MM:SS` 或 `HH:MM`
- 日期时间格式：`YYYY-MM-DD HH:MM:SS`

### 分页
当前版本API暂不支持分页，如需获取大量数据请使用时间范围参数限制。

## 示例代码

所有API文档都提供了Python requests库的示例代码，可直接复制使用。

## 更新日志

- **2025-12-12**: 
  - 全面更新社区管理API文档,新增14个接口
  - 明确HTTP状态码统一返回200的约定
  - 新增工作人员管理接口(主管/专员)
  - 新增社区用户管理接口
  - 新增社区合并/拆分接口
  - 添加特殊社区(安卡大家庭/黑屋)逻辑说明
  - 标记每个API的实现状态(✅已实现/⏳待实现)
  - 添加权限矩阵和实现优先级说明
- **2025-12-10**: 新增社区管理API文档，包含社区CRUD、用户管理、申请流程等功能
- **2025-12-09**: 更新响应状态码说明，成功响应返回 code: 1，错误响应返回 code: 0
- **2025-12-09**: 初始版本，根据生产代码生成完整API文档